# 图表导出格式使用指南

## 🎯 功能概述

GGplotChim 现已支持多种图表导出格式，让您可以根据不同使用场景选择最合适的格式。

## 📊 支持的格式

### 1. PNG - 高质量位图 ⭐ 推荐

**特点**：
- ✅ **无损压缩**：保持图像质量，不会丢失细节
- ✅ **支持透明背景**：可以导出带透明背景的图表
- ✅ **广泛兼容**：所有平台和应用都支持
- ✅ **高 DPI 支持**：可设置 720 DPI 获得打印级质量
- ⚠️ **文件较大**：高分辨率图像文件会比较大

**适用场景**：
- 📄 学术论文和出版物
- 🖨️ 高质量打印
- 🌐 网页展示
- 📱 PPT 和演示文稿

**质量设置**：
- 默认：20×20 英寸，720 DPI（约 14400×14400 像素）
- 推荐打印：720 DPI
- 推荐网页：300-400 DPI

---

### 2. JPEG - 压缩图像

**特点**：
- ✅ **文件小**：有损压缩，文件体积小
- ✅ **广泛支持**：所有设备都能打开
- ⚠️ **有损压缩**：可能会丢失一些细节
- ❌ **不支持透明背景**：始终有白色背景

**适用场景**：
- 📧 邮件附件（文件小）
- 🌐 网页快速加载
- 📱 社交媒体分享
- 💾 存储空间有限时

**注意事项**：
- JPEG 适合照片和复杂图像
- 对于图表和文字，PNG 质量更好
- 默认质量：95%（0.95）

---

### 3. SVG - 矢量图 🎨 专业首选

**特点**：
- ✅ **矢量格式**：无限缩放不失真
- ✅ **文件小**：基于 XML 文本，占用空间小
- ✅ **可编辑**：可以在 Illustrator、Inkscape 等软件中编辑
- ✅ **网页友好**：浏览器原生支持
- ⚠️ **兼容性**：某些旧版软件可能不支持

**适用场景**：
- 🖨️ 高质量印刷（杂志、海报）
- ✏️ 后期编辑和调整
- 📐 需要缩放的图表
- 🌐 响应式网页设计

**优势**：
- 不受分辨率限制
- 放大不会模糊
- 适合专业设计师

---

### 4. PDF - 文档格式 ⏳ 即将支持

**状态**：🚧 暂不可用（需要额外库支持）

**计划特点**：
- 📄 文档标准格式
- 🖨️ 打印友好
- 📚 适合归档和分享

---

## 🔧 使用方法

### 步骤 1：生成图表

1. 在画布上创建图表
2. 点击 **"▶ 运行代码"** 按钮生成图表
3. 等待图表在预览区域显示

### 步骤 2：设置导出参数（可选）

点击 **"⚙️ 设置"** 按钮，配置：

- **宽度**：图片宽度（英寸），默认 20
- **高度**：图片高度（英寸），默认 20
- **DPI**：分辨率（每英寸点数），默认 720
  - 300 DPI：标准打印质量
  - 600 DPI：高质量打印
  - 720 DPI：专业打印级别

**像素尺寸计算**：
```
像素宽度 = 宽度（英寸）× DPI
像素高度 = 高度（英寸）× DPI

例如：20×20 英寸 @ 720 DPI = 14400×14400 像素
```

### 步骤 3：选择格式并下载

1. 在 **"格式:"** 下拉菜单中选择导出格式
   - PNG（默认，推荐）
   - JPEG（文件更小）
   - SVG（矢量图）

2. 点击 **"下载 XXX"** 按钮
3. 系统会自动转换并下载文件

---

## 💡 格式选择建议

### 学术论文

**首选**：PNG (720 DPI)
- 清晰度高，细节丰富
- 期刊接受度高
- 支持透明背景

**备选**：SVG
- 编辑器可以直接编辑
- 适合后期调整

---

### 网页展示

**首选**：PNG (300-400 DPI)
- 质量好，文件适中
- 兼容性好

**备选**：SVG
- 矢量图，适应各种屏幕
- 响应式设计友好

---

### 打印海报

**首选**：SVG
- 矢量格式，无限缩放
- 专业印刷厂支持

**备选**：PNG (720 DPI)
- 超高分辨率
- 适合大幅面打印

---

### PPT/演示

**首选**：PNG (400 DPI)
- 清晰度够用
- 文件大小适中

**备选**：JPEG
- 文件更小
- 加载更快

---

### 社交媒体

**首选**：JPEG
- 文件小，上传快
- 平台会自动压缩

**备选**：PNG (300 DPI)
- 质量更好
- 适合需要透明背景的场景

---

## 📏 尺寸和 DPI 对照表

| 用途 | 推荐尺寸（英寸） | 推荐 DPI | 像素尺寸 | 格式 |
|-----|---------------|---------|---------|------|
| 网页展示 | 10×8 | 300 | 3000×2400 | PNG/JPEG |
| PPT 演示 | 12×9 | 400 | 4800×3600 | PNG |
| 学术论文 | 6×4.5 | 600 | 3600×2700 | PNG |
| 杂志印刷 | 8×6 | 720 | 5760×4320 | PNG/SVG |
| 海报打印 | 任意 | - | - | SVG |

---

## 🚀 技术细节

### 转换流程

1. **WebR 生成 SVG**：
   - R 代码在浏览器中运行
   - 使用 `svg()` 设备生成矢量图
   - 输出为 SVG data URL

2. **格式转换**（PNG/JPEG）：
   - 使用 HTML5 Canvas API
   - 将 SVG 渲染为位图
   - 应用 DPI 设置缩放
   - 导出为目标格式

3. **直接下载**（SVG）：
   - 无需转换
   - 直接保存 SVG 内容

### 质量保证

- **PNG**：无损压缩，完全保留细节
- **JPEG**：95% 质量因子，几乎无可见损失
- **SVG**：矢量格式，理论上无限清晰

---

## ⚠️ 注意事项

### 1. 文件大小

- **超高分辨率警告**：
  - 20×20 英寸 @ 720 DPI ≈ 600 MB 未压缩
  - PNG 压缩后约 50-100 MB
  - 浏览器可能需要几秒钟处理

**建议**：
- 网页用途：降低到 300-400 DPI
- 打印用途：保持 600-720 DPI

### 2. 浏览器兼容性

- **现代浏览器**：Chrome、Firefox、Edge、Safari 完全支持
- **旧版浏览器**：可能不支持 Canvas 或 SVG 高级功能
- **移动设备**：超大图像可能导致内存不足

### 3. 中文字体

- 确保在 **"🔤 字体"** 中选择了合适的中文字体
- SVG 格式依赖系统字体，可能在其他设备上显示不同
- PNG/JPEG 会将字体渲染为像素，不依赖系统字体

---

## 🔍 故障排除

### 问题：PNG 文件无法打开

**原因**：之前版本将 SVG 保存为 .png 扩展名

**解决方案**：
1. 更新到最新版本
2. 选择正确的导出格式
3. 重新下载图表

---

### 问题：图像转换时间长

**原因**：高分辨率图像需要大量计算

**解决方案**：
1. 降低 DPI（例如从 720 降到 400）
2. 减小尺寸（例如从 20×20 改为 10×10）
3. 使用 SVG 格式（无需转换）

---

### 问题：JPEG 质量不好

**原因**：JPEG 是有损压缩格式

**解决方案**：
1. 改用 PNG 格式
2. 使用 SVG 矢量格式
3. 增加 DPI 设置

---

### 问题：SVG 在其他软件中字体不正确

**原因**：SVG 依赖系统字体，目标设备可能没有安装

**解决方案**：
1. 使用常见字体（宋体、Arial 等）
2. 导出为 PNG（字体被渲染为像素）
3. 在 Illustrator 等软件中将字体转为路径

---

## 📚 更多资源

- **WebR 文档**：https://docs.r-wasm.org/webr/latest/
- **ggplot2 文档**：https://ggplot2.tidyverse.org/
- **SVG 规范**：https://www.w3.org/Graphics/SVG/

---

## 🎉 总结

选择合适的导出格式可以让您的图表在不同场景下都有最佳表现：

- 🏆 **PNG**：全能选手，适合大多数场景
- 💼 **JPEG**：文件小，适合网络传播
- 🎨 **SVG**：专业首选，适合编辑和印刷
- 📄 **PDF**：即将支持，敬请期待

根据您的需求选择合适的格式，获得最佳的图表质量！

---

**最后更新**：2025-10-05  
**版本**：v1.2.0

